
var __slice=Array.prototype.slice;(function(a){var b;a.fn.sketch=function(){var c,d,e;d=arguments[0],c=2<=arguments.length?__slice.call(arguments,1):[];if(this.length>1){a.error("Sketch.js can only be called on one element at a time.")}e=this.data("sketch");if(typeof d==="string"&&e){if(e[d]){if(typeof e[d]==="function"){return e[d].apply(e,c)}else{if(c.length===0){return e[d]}else{if(c.length===1){return e[d]=c[0]}}}}else{return a.error("Sketch.js did not recognize the given command.")}}else{if(e){return e}else{this.data("sketch",new b(this.get(0),d));return this}}};b=(function(){function c(d,e){this.el=d;this.canvas=a(d);this.context=d.getContext("2d");this.options=a.extend({toolLinks:true,defaultTool:"marker",defaultColor:"#000000",defaultSize:5},e);this.painting=false;this.color=this.options.defaultColor;this.size=this.options.defaultSize;this.tool=this.options.defaultTool;this.actions=[];this.action=[];this.canvas.bind("click mousedown mouseup mousemove mouseleave mouseout touchstart touchmove touchend touchcancel",this.onEvent);if(this.options.toolLinks){a("body").delegate('a[href="#'+(this.canvas.attr("id"))+'"]',"click",function(l){var h,k,g,m,j,f,i;k=a(this);h=a(k.attr("href"));m=h.data("sketch");i=["color","size","tool"];for(j=0,f=i.length;j<f;j++){g=i[j];if(k.attr("data-"+g)){m.set(g,a(this).attr("data-"+g))}}if(a(this).attr("data-download")){m.download(a(this).attr("data-download"))}return false})}}c.prototype.download=function(e){var d;e||(e="png");if(e==="jpg"){e="jpeg"}d="image/"+e;return window.open(this.el.toDataURL(d))};c.prototype.set=function(d,e){this[d]=e;return this.canvas.trigger("sketch.change"+d,e)};c.prototype.startPainting=function(){this.painting=true;return this.action={tool:this.tool,color:this.color,size:parseFloat(this.size),events:[]}};c.prototype.stopPainting=function(){if(this.action){this.actions.push(this.action)}this.painting=false;this.action=null;return this.redraw()};c.prototype.onEvent=function(d){if(d.originalEvent&&d.originalEvent.targetTouches){d.pageX=d.originalEvent.targetTouches[0].pageX;d.pageY=d.originalEvent.targetTouches[0].pageY}a.sketch.tools[a(this).data("sketch").tool].onEvent.call(a(this).data("sketch"),d);d.preventDefault();return false};c.prototype.redraw=function(){var d;this.context=this.el.getContext("2d");d=this;a.each(this.actions,function(){if(this.tool){return a.sketch.tools[this.tool].draw.call(d,this)}});if(this.painting&&this.action){return a.sketch.tools[this.action.tool].draw.call(d,this.action)}};return c})();a.sketch={tools:{}};a.sketch.tools.marker={onEvent:function(c){switch(c.type){case"mousedown":case"touchstart":if(this.painting){this.stopPainting()}this.startPainting();break;case"mouseup":case"mouseout":case"mouseleave":case"touchend":case"touchcancel":this.stopPainting()}if(this.painting){this.action.events.push({x:c.pageX-this.canvas.offset().left,y:c.pageY-this.canvas.offset().top,event:c.type});return this.redraw()}},draw:function(h){var e,d,g,c,f;this.context.lineJoin="round";this.context.lineCap="round";this.context.beginPath();this.context.moveTo(h.events[0].x,h.events[0].y);f=h.events;for(g=0,c=f.length;g<c;g++){e=f[g];this.context.lineTo(e.x,e.y);d=e}this.context.strokeStyle=h.color;this.context.lineWidth=h.size;return this.context.stroke()}};return a.sketch.tools.eraser={onEvent:function(c){return a.sketch.tools.marker.onEvent.call(this,c)},draw:function(d){var c;c=this.context.globalCompositeOperation;this.context.globalCompositeOperation="copy";d.color="rgba(0,0,0,0)";a.sketch.tools.marker.draw.call(this,d);return this.context.globalCompositeOperation=c}}})(jQuery);